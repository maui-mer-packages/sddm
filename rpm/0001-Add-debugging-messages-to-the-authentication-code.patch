From b14ae3abe3a8d775bff17ae2c8f1914b0ed72c42 Mon Sep 17 00:00:00 2001
From: Pier Luigi Fiorini <pierluigi.fiorini@gmail.com>
Date: Fri, 11 Jul 2014 20:45:01 +0200
Subject: [PATCH 1/4] Add debugging messages to the authentication code

Helps tracking errors. Also explicitely evaluate exit code.
---
 src/auth/Auth.cpp | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/src/auth/Auth.cpp b/src/auth/Auth.cpp
index cd8bd11..dfdcc05 100644
--- a/src/auth/Auth.cpp
+++ b/src/auth/Auth.cpp
@@ -185,9 +185,17 @@ void Auth::Private::dataPending() {
 }
 
 void Auth::Private::childExited(int exitCode, QProcess::ExitStatus exitStatus) {
-    if (exitStatus != QProcess::NormalExit)
+    if (exitStatus != QProcess::NormalExit) {
+        qWarning("Auth: sddm-helper crashed (exit code %d)", exitCode);
         Q_EMIT qobject_cast<Auth*>(parent())->error(child->errorString(), ERROR_INTERNAL);
-    Q_EMIT qobject_cast<Auth*>(parent())->finished(!exitCode);
+    }
+
+    if (exitCode == 0)
+        qDebug() << "Auth: sddm-helper exited successfully";
+    else
+        qWarning("Auth: sddm-helper exited with %d", exitCode);
+
+    Q_EMIT qobject_cast<Auth*>(parent())->finished(exitCode == 0);
 }
 
 void Auth::Private::childError(QProcess::ProcessError error) {
-- 
2.0.1

